---
// Language redirect component
---

<script>
  // Browser language detection and redirect
  function detectAndRedirect() {
    // Get browser's preferred languages
    const browserLangs = navigator.languages || [navigator.language];
    
    // Supported locales
    const supportedLocales = ['zh-cn', 'en'];
    const defaultLocale = 'zh-cn';
    
    // Find the best match
    let targetLocale = defaultLocale;
    
    for (const browserLang of browserLangs) {
      // Normalize browser language (e.g., 'zh-CN' -> 'zh-cn', 'en-US' -> 'en')
      const normalizedLang = browserLang.toLowerCase();
      
      // Check for exact match first
      if (supportedLocales.includes(normalizedLang)) {
        targetLocale = normalizedLang;
        break;
      }
      
      // Check for language prefix match (e.g., 'zh-CN' matches 'zh-cn')
      const langPrefix = normalizedLang.split('-')[0];
      const matchedLocale = supportedLocales.find(locale => 
        locale.startsWith(langPrefix) || locale.split('-')[0] === langPrefix
      );
      
      if (matchedLocale) {
        targetLocale = matchedLocale;
        break;
      }
    }
    
    // Redirect to the detected language
    const targetUrl = `/${targetLocale}/`;
    
    // Avoid infinite redirect loop
    if (window.location.pathname !== targetUrl) {
      window.location.replace(targetUrl);
    }
  }
  
  // Execute redirect when page loads
  if (typeof window !== 'undefined') {
    detectAndRedirect();
  }
</script>

<div style="text-align: center; padding: 2rem;">
  <h1>Welcome to Cactus</h1>
  <p>Detecting your preferred language and redirecting...</p>
  <p>正在检测您的首选语言并跳转...</p>
  
  <div style="margin-top: 2rem;">
    <p>If you are not redirected automatically, please choose your language:</p>
    <p>如果没有自动跳转，请选择您的语言：</p>
    
    <div style="margin-top: 1rem;">
      <a href="/zh-cn/" style="margin: 0 1rem; padding: 0.5rem 1rem; background: #0066cc; color: white; text-decoration: none; border-radius: 4px;">简体中文</a>
      <a href="/en/" style="margin: 0 1rem; padding: 0.5rem 1rem; background: #0066cc; color: white; text-decoration: none; border-radius: 4px;">English</a>
    </div>
  </div>
</div>

<noscript>
  <div style="text-align: center; padding: 2rem;">
    <h1>Welcome to Cactus</h1>
    <p>Please choose your language / 请选择您的语言：</p>
    
    <div style="margin-top: 1rem;">
      <a href="/zh-cn/" style="margin: 0 1rem; padding: 0.5rem 1rem; background: #0066cc; color: white; text-decoration: none; border-radius: 4px;">简体中文</a>
      <a href="/en/" style="margin: 0 1rem; padding: 0.5rem 1rem; background: #0066cc; color: white; text-decoration: none; border-radius: 4px;">English</a>
    </div>
  </div>
</noscript>